import streamlit as st
import pandas as pd
import numpy as np
import scipy.stats as stats
import matplotlib.pyplot as plt


def main():
    st.title("üìä –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞: –ü–§–≠ –¥–ª—è –¥–≤—É—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤")
    st.subheader("–í–∞—Ä–∏–∞–Ω—Ç ‚Ññ1")

    # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    st.markdown("### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    data = np.array([
        [20, 18, 20],
        [9, 11, 10],
        [28, 26, 27],
        [12, 14, 13]
    ])

    df_original = pd.DataFrame(data,
                               columns=['Y‚ÇÅ', 'Y‚ÇÇ', 'Y‚ÇÉ'],
                               index=['–û–ø—ã—Ç 1', '–û–ø—ã—Ç 2', '–û–ø—ã—Ç 3', '–û–ø—ã—Ç 4'])
    st.dataframe(df_original)

    # 1. –ú–∞—Ç—Ä–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º
    st.markdown("---")
    st.markdown("## 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–∫–ª–∏–∫–∞")

    st.markdown("""
    **–î–∏–∞–ø–∞–∑–æ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–π —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤:**
    - CaCl‚ÇÇ: 0-2%
    - –ö–°–°–ë: 1-3%
    """)

    st.markdown("""
    **–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–æ–≤:**

    –ü—É—Å—Ç—å $x_1$ ‚Äì –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è CaCl‚ÇÇ; $x_2$ ‚Äì –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ö–°–°–ë. –¢–æ–≥–¥–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å:

    $$x_1^0 = \\frac{x_1^{\\max} + x_1^{\\min}}{2} = \\frac{2 + 0}{2} = 1$$

    $$x_2^0 = \\frac{x_2^{\\max} + x_2^{\\min}}{2} = \\frac{3 + 1}{2} = 2$$

    –ò–Ω—Ç–µ—Ä–≤–∞–ª (—à–∞–≥) –≤–∞—Ä—å–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤:

    $$\\Delta x_1 = \\frac{x_1^{\\max} - x_1^{\\min}}{2} = \\frac{2 - 0}{2} = 1$$

    $$\\Delta x_2 = \\frac{x_2^{\\max} - x_2^{\\min}}{2} = \\frac{3 - 1}{2} = 1$$
    """)

    # –ú–∞—Ç—Ä–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º
    planning_matrix = np.array([
        [-1, -1, 1],  # –û–ø—ã—Ç 1: x1, x2, x1x2
        [-1, 1, -1],  # –û–ø—ã—Ç 2: x1, x2, x1x2
        [1, -1, -1],  # –û–ø—ã—Ç 3: x1, x2, x1x2
        [1, 1, 1]  # –û–ø—ã—Ç 4: x1, x2, x1x2
    ])

    df_planning = pd.DataFrame(planning_matrix,
                               columns=['xÃÑ‚ÇÅ', 'xÃÑ‚ÇÇ', 'xÃÑ‚ÇÅxÃÑ‚ÇÇ'],
                               index=['–û–ø—ã—Ç 1', '–û–ø—ã—Ç 2', '–û–ø—ã—Ç 3', '–û–ø—ã—Ç 4'])

    # –î–æ–±–∞–≤–ª—è–µ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    mean_response = np.mean(data, axis=1)
    df_planning['Y‚ÇÅ'] = data[:, 0]
    df_planning['Y‚ÇÇ'] = data[:, 1]
    df_planning['Y‚ÇÉ'] = data[:, 2]
    df_planning['»≤·µ¢'] = mean_response

    # –†–∞—Å—á–µ—Ç –¥–∏—Å–ø–µ—Ä—Å–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø—ã—Ç–∞
    variances = np.var(data, axis=1, ddof=1)
    df_planning['S·µ¢¬≤'] = variances

    st.markdown("**–¢–∞–±–ª–∏—Ü–∞ 2. –ú–∞—Ç—Ä–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –ü–§–≠ –ø—Ä–∏ –¥–≤—É—Ö —Ñ–∞–∫—Ç–æ—Ä–∞—Ö, –≤–∞—Ä—å–∏—Ä—É–µ–º—ã—Ö –Ω–∞ –¥–≤—É—Ö —É—Ä–æ–≤–Ω—è—Ö**")
    st.dataframe(df_planning)

    # 2. –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
    st.markdown("""
    **–†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏:**

    –û–±—â–∏–π –≤–∏–¥ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏:
    $$Y = \\tau_0 = b_0 + b_1\\overline{x_1} + b_2\\overline{x_2} + b_{12}\\overline{x_1}\\overline{x_2}$$

    –§–æ—Ä–º—É–ª—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:
    - $b_0 = \\frac{\\sum \\overline{Y_i}}{N}$
    - $b_j = \\frac{\\sum x_{ij} \\cdot \\overline{Y_i}}{N}$
    """)

    # –†–∞—Å—á–µ—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏
    N = len(data)
    n = data.shape[1]  # —á–∏—Å–ª–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ—Å—Ç–µ–π

    # b0 = sum(Yi) / N
    b0 = np.sum(mean_response) / N

    # bi = sum(xi * Yi) / N
    b1 = np.sum(planning_matrix[:, 0] * mean_response) / N
    b2 = np.sum(planning_matrix[:, 1] * mean_response) / N
    b12 = np.sum(planning_matrix[:, 2] * mean_response) / N

    coefficients = np.array([b0, b1, b2, b12])

    st.write(f"$b_0 = {coefficients[0]:.4f}$")
    st.write(f"$b_1 = {coefficients[1]:.4f}$")
    st.write(f"$b_2 = {coefficients[2]:.4f}$")
    st.write(f"$b_{{12}} = {coefficients[3]:.4f}$")

    # –£—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
    st.markdown(f"**–£—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏:**")
    st.markdown(
        f"$$\\tau_0 = {coefficients[0]:.4f} + {coefficients[1]:.4f} \\cdot \\overline{{x_1}} + {coefficients[2]:.4f} \\cdot \\overline{{x_2}} + {coefficients[3]:.4f} \\cdot \\overline{{x_1}} \\overline{{x_2}}$$")

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ –¥–∏—Å–ø–µ—Ä—Å–∏–π (–∫—Ä–∏—Ç–µ—Ä–∏–π –ö–æ—Ö—Ä–µ–Ω–∞)
    st.markdown("---")
    st.markdown("## 2. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏")

    st.markdown("""
    **–û—Ü–µ–Ω–∫–∞ –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é –ö–æ—Ö—Ä–µ–Ω–∞:**

    $$S_i^2 = \\frac{\\sum_{j=1}^n (Y_{ij} - \\overline{Y_i})^2}{n - 1}$$

    $$G = \\frac{S^2_{\\max}}{\\sum_{i=1}^N S_i^2}$$
    """)

    # –ö—Ä–∏—Ç–µ—Ä–∏–π –ö–æ—Ö—Ä–µ–Ω–∞
    G_exp = np.max(variances) / np.sum(variances)

    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    alpha = 0.05
    f1 = n - 1  # 3 - 1 = 2 (—á–∏—Å–ª–æ —Å—Ç–µ–ø–µ–Ω–µ–π —Å–≤–æ–±–æ–¥—ã)
    f2 = N  # 4 (—á–∏—Å–ª–æ –æ–ø—ã—Ç–æ–≤)

    # –¢–∞–±–ª–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è G(0.05, 4, 2)
    G_table = 0.7679

    st.write(f"**–†–∞—Å—á–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è –ö–æ—Ö—Ä–µ–Ω–∞:** $G = {G_exp:.4f}$")
    st.write(f"**–¢–∞–±–ª–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** $G({alpha}, {f1}, {f2}) = {G_table:.4f}$")

    if G_exp < G_table:
        st.success("‚úÖ –î–∏—Å–ø–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã ($G_{—Ä–∞—Å—á} < G_{—Ç–∞–±–ª}$)")
    else:
        st.error("‚ùå –î–∏—Å–ø–µ—Ä—Å–∏–∏ –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω—ã ($G_{—Ä–∞—Å—á} ‚â• G_{—Ç–∞–±–ª}$)")

    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
    st.markdown("---")
    st.markdown("### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤")

    st.markdown("""
    **–§–æ—Ä–º—É–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:**

    –î–∏—Å–ø–µ—Ä—Å–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏:
    $$S^2(Y) = \\frac{\\sum_{i=1}^N S_i^2}{N}$$

    –î–∏—Å–ø–µ—Ä—Å–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:
    $$S^2(b_j) = \\frac{S^2(Y)}{N \\cdot n}$$

    –ö—Ä–∏—Ç–µ—Ä–∏–π –°—Ç—å—é–¥–µ–Ω—Ç–∞:
    $$t_j = \\frac{|b_j|}{S(b_j)}$$
    """)

    # –î–∏—Å–ø–µ—Ä—Å–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ (–ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ)
    S2_Y = np.mean(variances)
    st.write(f"$S^2(Y) = {S2_Y:.4f}$")

    # –î–∏—Å–ø–µ—Ä—Å–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (–ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ)
    S2_bi = S2_Y / (N * n)
    S_bi = np.sqrt(S2_bi)
    st.write(f"$S^2(b_j) = {S2_bi:.4f}$")
    st.write(f"$S(b_j) = {S_bi:.4f}$")

    # –ö—Ä–∏—Ç–µ—Ä–∏–π –°—Ç—å—é–¥–µ–Ω—Ç–∞
    k_student = N * (n - 1)  # —Å—Ç–µ–ø–µ–Ω–∏ —Å–≤–æ–±–æ–¥—ã = 4 * 2 = 8
    t_table = stats.t.ppf(1 - alpha / 2, k_student)

    # –†–∞—Å—á–µ—Ç t-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –¥–ª—è –≤—Å–µ—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
    t_values = np.abs(coefficients) / S_bi

    df_significance = pd.DataFrame({
        '–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç': ['b‚ÇÄ', 'b‚ÇÅ', 'b‚ÇÇ', 'b‚ÇÅ‚ÇÇ'],
        '–ó–Ω–∞—á–µ–Ω–∏–µ': coefficients,
        't-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞': t_values,
        '–ó–Ω–∞—á–∏–º—ã–π': t_values > t_table
    })

    st.dataframe(df_significance)
    st.write(f"**–¢–∞–±–ª–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ t-–∫—Ä–∏—Ç–µ—Ä–∏—è:** $t({alpha}, {k_student}) = {t_table:.4f}$")

    significant_coeffs = all(t_values > t_table)
    if significant_coeffs:
        st.success("‚úÖ –í—Å–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —É—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∑–Ω–∞—á–∏–º—ã")
    else:
        st.warning("‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–µ–∑–Ω–∞—á–∏–º—ã")

    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏
    st.markdown("---")
    st.markdown("### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏")

    st.markdown("""
    **–ö—Ä–∏—Ç–µ—Ä–∏–π –§–∏—à–µ—Ä–∞:**

    $$F = \\frac{S_A^2}{S^2(Y)}$$

    –≥–¥–µ $S_A^2$ ‚Äì –æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è:

    $$S_A^2 = \\frac{n \\cdot \\sum_{i=1}^N (\\overline{Y_i} - Y_{pi})^2}{N - k - 1}$$

    –≥–¥–µ $Y_{pi}$ ‚Äì —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ –ø–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—é —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–µ.
    """)

    # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    X_matrix = np.column_stack([np.ones(N), planning_matrix])
    y_pred = X_matrix @ coefficients

    # –û—Å—Ç–∞—Ç–∫–∏
    residuals = mean_response - y_pred


    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    comparison_df = pd.DataFrame({
        '–û–ø—ã—Ç': ['–û–ø—ã—Ç 1', '–û–ø—ã—Ç 2', '–û–ø—ã—Ç 3', '–û–ø—ã—Ç 4'],
        '»≤·µ¢ (—ç–∫—Å–ø.)': mean_response,
        'Y‚Çö·µ¢ (—Ä–∞—Å—á.)': y_pred,
        '–†–∞–∑–Ω–æ—Å—Ç—å': mean_response - y_pred
    })

    st.dataframe(comparison_df)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
    max_deviation = np.max(np.abs(mean_response - y_pred))
    st.write(f"**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:** ${max_deviation:.6f}$")

    st.success("""
            ‚úÖ **–û—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è —Ä–∞–≤–Ω–∞ 0.** 

            –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞—Ç–∫–∏ –≤ –º–æ–¥–µ–ª–∏ —Ä–∞–≤–Ω—ã –Ω—É–ª—é, —á—Ç–æ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ–± –∏–¥–µ–∞–ª—å–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ 
            –º–µ–∂–¥—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ú–æ–¥–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–∏—Å—ã–≤–∞–µ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
            """)
    # 6. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    st.markdown("---")
    st.markdown("## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")

    fig, axes = plt.subplots(1, 2, figsize=(15, 6))

    # –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö vs –Ω–∞–±–ª—é–¥–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    axes[0].scatter(mean_response, y_pred, color='blue', s=100)
    axes[0].plot([min(mean_response), max(mean_response)],
                 [min(mean_response), max(mean_response)],
                 'r--', alpha=0.8)
    axes[0].set_xlabel('–ù–∞–±–ª—é–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è Y')
    axes[0].set_ylabel('–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ≈∂')
    axes[0].set_title('–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ vs –ù–∞–±–ª—é–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è')
    axes[0].grid(True, alpha=0.3)

    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∏ —Ç–æ—á–µ–∫
    for i, (x, y) in enumerate(zip(mean_response, y_pred)):
        axes[0].annotate(f'–û–ø—ã—Ç {i + 1}', (x, y), xytext=(5, 5),
                         textcoords='offset points', fontsize=8)

    # –ì—Ä–∞—Ñ–∏–∫ –æ—Å—Ç–∞—Ç–∫–æ–≤
    axes[1].scatter(range(len(residuals)), residuals, color='red', s=100)
    axes[1].axhline(y=0, color='black', linestyle='-')
    axes[1].set_xlabel('–ù–æ–º–µ—Ä –æ–ø—ã—Ç–∞')
    axes[1].set_ylabel('–û—Å—Ç–∞—Ç–∫–∏')
    axes[1].set_title('–ì—Ä–∞—Ñ–∏–∫ –æ—Å—Ç–∞—Ç–∫–æ–≤')
    axes[1].grid(True, alpha=0.3)

    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
    for i, (x, y) in enumerate(zip(range(len(residuals)), residuals)):
        axes[1].annotate(f'{y:.2f}', (x, y), xytext=(5, 5),
                         textcoords='offset points', fontsize=8)

    plt.tight_layout()
    st.pyplot(fig)

    # –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
    st.markdown("---")
    st.markdown("## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ")

    st.markdown("""
    –í —Ö–æ–¥–µ –¥–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ –æ–ø—ã—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, 
    –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–¥–µ–ª—å–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è —Å–¥–≤–∏–≥–∞ –æ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è 
    –≤ –±—É—Ä–æ–≤–æ–º —Ä–∞—Å—Ç–≤–æ—Ä–µ CaCl‚ÇÇ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 0 –¥–æ 2% –∏ –ö–°–°–ë –æ—Ç 1 –¥–æ 3%. 

    –ë—ã–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞—Å—Ç–≤–æ—Ä–∞ 
    –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω–æ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤. –° —Ü–µ–ª—å—é –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –±—ã–ª–∏ 
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –∫—Ä–∏—Ç–µ—Ä–∏–π –ö–æ—Ö—Ä–µ–Ω–∞, –°—Ç—å—é–¥–µ–Ω—Ç–∞ –∏ –§–∏—à–µ—Ä–∞, 
    –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å, —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª–∏–∫–∞ 
    –∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏.

    –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏, —á—Ç–æ –∞–Ω–∞–ª–∏–∑ –±—ã–ª –ø—Ä–æ–≤–µ–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–∞—è 
    –º–æ–¥–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º.
    """)

    # –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    st.markdown("---")
    st.markdown("## –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã")

    results_df = pd.DataFrame({
        '–ü–∞—Ä–∞–º–µ—Ç—Ä': [
            '–£—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏',
            '–û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏–π',
            '–ó–Ω–∞—á–∏–º–æ—Å—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤',
            '–ö–∞—á–µ—Å—Ç–≤–æ –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏–∏'
        ],
        '–†–µ–∑—É–ª—å—Ç–∞—Ç': [
            f'≈∑ = {coefficients[0]:.4f} + {coefficients[1]:.4f}¬∑xÃÑ‚ÇÅ + {coefficients[2]:.4f}¬∑xÃÑ‚ÇÇ + {coefficients[3]:.4f}¬∑xÃÑ‚ÇÅxÃÑ‚ÇÇ',
            '–û–¥–Ω–æ—Ä–æ–¥–Ω—ã' if G_exp < G_table else '–ù–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω—ã',
            '–í—Å–µ –∑–Ω–∞—á–∏–º—ã' if significant_coeffs else '–ù–µ –≤—Å–µ –∑–Ω–∞—á–∏–º—ã',
            '–û—Ç–ª–∏—á–Ω–æ–µ' if max_deviation < 0.01 else '–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏'
        ]
    })

    st.dataframe(results_df)


if __name__ == "__main__":
    main()